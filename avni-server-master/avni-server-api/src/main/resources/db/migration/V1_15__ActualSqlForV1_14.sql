DROP POLICY address_level_orgs ON address_level;
DROP POLICY catchment_orgs ON catchment;
DROP POLICY catchment_address_mapping_orgs ON catchment_address_mapping;
DROP POLICY concept_orgs ON concept;
DROP POLICY concept_answer_orgs ON concept_answer;
DROP POLICY encounter_type_orgs ON encounter_type;
DROP POLICY form_orgs ON form;
DROP POLICY form_element_orgs ON form_element;
DROP POLICY form_element_group_orgs ON form_element_group;
DROP POLICY form_mapping_orgs ON form_mapping;
DROP POLICY users_orgs ON users;
DROP POLICY program_orgs ON program;
DROP POLICY program_outcome_orgs ON program_outcome;
DROP POLICY operational_encounter_type_orgs ON operational_encounter_type;
DROP POLICY operational_program_orgs ON operational_program;
DROP POLICY non_applicable_form_element_orgs ON non_applicable_form_element;

CREATE POLICY address_level_orgs ON address_level USING (organisation_id IN (WITH RECURSIVE list_of_orgs(id, parent_organisation_id) AS ( SELECT id, parent_organisation_id FROM organisation WHERE db_user = current_user UNION ALL SELECT o.id, o.parent_organisation_id FROM organisation o, list_of_orgs log WHERE o.id = log.parent_organisation_id ) SELECT id FROM list_of_orgs)) WITH CHECK ((organisation_id = (select id from organisation where db_user = current_user)));
CREATE POLICY catchment_orgs ON catchment USING (organisation_id IN (WITH RECURSIVE list_of_orgs(id, parent_organisation_id) AS ( SELECT id, parent_organisation_id FROM organisation WHERE db_user = current_user UNION ALL SELECT o.id, o.parent_organisation_id FROM organisation o, list_of_orgs log WHERE o.id = log.parent_organisation_id ) SELECT id FROM list_of_orgs)) WITH CHECK ((organisation_id = (select id from organisation where db_user = current_user)));
CREATE POLICY catchment_address_mapping_orgs ON catchment_address_mapping USING (organisation_id IN (WITH RECURSIVE list_of_orgs(id, parent_organisation_id) AS ( SELECT id, parent_organisation_id FROM organisation WHERE db_user = current_user UNION ALL SELECT o.id, o.parent_organisation_id FROM organisation o, list_of_orgs log WHERE o.id = log.parent_organisation_id ) SELECT id FROM list_of_orgs)) WITH CHECK ((organisation_id = (select id from organisation where db_user = current_user)));
CREATE POLICY concept_orgs ON concept USING (organisation_id IN (WITH RECURSIVE list_of_orgs(id, parent_organisation_id) AS ( SELECT id, parent_organisation_id FROM organisation WHERE db_user = current_user UNION ALL SELECT o.id, o.parent_organisation_id FROM organisation o, list_of_orgs log WHERE o.id = log.parent_organisation_id ) SELECT id FROM list_of_orgs)) WITH CHECK ((organisation_id = (select id from organisation where db_user = current_user)));
CREATE POLICY concept_answer_orgs ON concept_answer USING (organisation_id IN (WITH RECURSIVE list_of_orgs(id, parent_organisation_id) AS ( SELECT id, parent_organisation_id FROM organisation WHERE db_user = current_user UNION ALL SELECT o.id, o.parent_organisation_id FROM organisation o, list_of_orgs log WHERE o.id = log.parent_organisation_id ) SELECT id FROM list_of_orgs)) WITH CHECK ((organisation_id = (select id from organisation where db_user = current_user)));
CREATE POLICY encounter_type_orgs ON encounter_type USING (organisation_id IN (WITH RECURSIVE list_of_orgs(id, parent_organisation_id) AS ( SELECT id, parent_organisation_id FROM organisation WHERE db_user = current_user UNION ALL SELECT o.id, o.parent_organisation_id FROM organisation o, list_of_orgs log WHERE o.id = log.parent_organisation_id ) SELECT id FROM list_of_orgs)) WITH CHECK ((organisation_id = (select id from organisation where db_user = current_user)));
CREATE POLICY form_orgs ON form USING (organisation_id IN (WITH RECURSIVE list_of_orgs(id, parent_organisation_id) AS ( SELECT id, parent_organisation_id FROM organisation WHERE db_user = current_user UNION ALL SELECT o.id, o.parent_organisation_id FROM organisation o, list_of_orgs log WHERE o.id = log.parent_organisation_id ) SELECT id FROM list_of_orgs)) WITH CHECK ((organisation_id = (select id from organisation where db_user = current_user)));
CREATE POLICY form_element_orgs ON form_element USING (organisation_id IN (WITH RECURSIVE list_of_orgs(id, parent_organisation_id) AS ( SELECT id, parent_organisation_id FROM organisation WHERE db_user = current_user UNION ALL SELECT o.id, o.parent_organisation_id FROM organisation o, list_of_orgs log WHERE o.id = log.parent_organisation_id ) SELECT id FROM list_of_orgs)) WITH CHECK ((organisation_id = (select id from organisation where db_user = current_user)));
CREATE POLICY form_element_group_orgs ON form_element_group USING (organisation_id IN (WITH RECURSIVE list_of_orgs(id, parent_organisation_id) AS ( SELECT id, parent_organisation_id FROM organisation WHERE db_user = current_user UNION ALL SELECT o.id, o.parent_organisation_id FROM organisation o, list_of_orgs log WHERE o.id = log.parent_organisation_id ) SELECT id FROM list_of_orgs)) WITH CHECK ((organisation_id = (select id from organisation where db_user = current_user)));
CREATE POLICY form_mapping_orgs ON form_mapping USING (organisation_id IN (WITH RECURSIVE list_of_orgs(id, parent_organisation_id) AS ( SELECT id, parent_organisation_id FROM organisation WHERE db_user = current_user UNION ALL SELECT o.id, o.parent_organisation_id FROM organisation o, list_of_orgs log WHERE o.id = log.parent_organisation_id ) SELECT id FROM list_of_orgs)) WITH CHECK ((organisation_id = (select id from organisation where db_user = current_user)));
CREATE POLICY users_orgs ON users USING (organisation_id IN (WITH RECURSIVE list_of_orgs(id, parent_organisation_id) AS ( SELECT id, parent_organisation_id FROM organisation WHERE db_user = current_user UNION ALL SELECT o.id, o.parent_organisation_id FROM organisation o, list_of_orgs log WHERE o.id = log.parent_organisation_id ) SELECT id FROM list_of_orgs)) WITH CHECK ((organisation_id = (select id from organisation where db_user = current_user)));
CREATE POLICY program_orgs ON program USING (organisation_id IN (WITH RECURSIVE list_of_orgs(id, parent_organisation_id) AS ( SELECT id, parent_organisation_id FROM organisation WHERE db_user = current_user UNION ALL SELECT o.id, o.parent_organisation_id FROM organisation o, list_of_orgs log WHERE o.id = log.parent_organisation_id ) SELECT id FROM list_of_orgs)) WITH CHECK ((organisation_id = (select id from organisation where db_user = current_user)));
CREATE POLICY program_outcome_orgs ON program_outcome USING (organisation_id IN (WITH RECURSIVE list_of_orgs(id, parent_organisation_id) AS ( SELECT id, parent_organisation_id FROM organisation WHERE db_user = current_user UNION ALL SELECT o.id, o.parent_organisation_id FROM organisation o, list_of_orgs log WHERE o.id = log.parent_organisation_id ) SELECT id FROM list_of_orgs)) WITH CHECK ((organisation_id = (select id from organisation where db_user = current_user)));
CREATE POLICY operational_encounter_type_orgs ON operational_encounter_type USING (organisation_id IN (WITH RECURSIVE list_of_orgs(id, parent_organisation_id) AS ( SELECT id, parent_organisation_id FROM organisation WHERE db_user = current_user UNION ALL SELECT o.id, o.parent_organisation_id FROM organisation o, list_of_orgs log WHERE o.id = log.parent_organisation_id ) SELECT id FROM list_of_orgs)) WITH CHECK ((organisation_id = (select id from organisation where db_user = current_user)));
CREATE POLICY operational_program_orgs ON operational_program USING (organisation_id IN (WITH RECURSIVE list_of_orgs(id, parent_organisation_id) AS ( SELECT id, parent_organisation_id FROM organisation WHERE db_user = current_user UNION ALL SELECT o.id, o.parent_organisation_id FROM organisation o, list_of_orgs log WHERE o.id = log.parent_organisation_id ) SELECT id FROM list_of_orgs)) WITH CHECK ((organisation_id = (select id from organisation where db_user = current_user)));
CREATE POLICY non_applicable_form_element_orgs ON non_applicable_form_element USING (organisation_id IN (WITH RECURSIVE list_of_orgs(id, parent_organisation_id) AS ( SELECT id, parent_organisation_id FROM organisation WHERE db_user = current_user UNION ALL SELECT o.id, o.parent_organisation_id FROM organisation o, list_of_orgs log WHERE o.id = log.parent_organisation_id ) SELECT id FROM list_of_orgs)) WITH CHECK ((organisation_id = (select id from organisation where db_user = current_user)));